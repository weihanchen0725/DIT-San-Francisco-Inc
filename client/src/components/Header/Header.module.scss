@import "../../assets/styles/mixin";

.header {
  @include flex-row-start-center;
  position: sticky;
  top: 0;
  height: 97px;
  min-height: 97px;
  box-sizing: border-box;
  // Keep in sync with `HeaderClient` threshold: scrolled style starts after 1rem.
  margin-top: 1rem;
  flex-wrap: nowrap;
  gap: 0.75rem 1rem;
  container-type: inline-size;
  // Interpolate from current responsive padding to target 0.5rem 1rem.
  padding-block: calc(
    var(--header-padding-block-start, clamp(0.75rem, 2vw, 1rem)) +
      (0.5rem - var(--header-padding-block-start, clamp(0.75rem, 2vw, 1rem))) *
      var(--header-scroll-progress, 0)
  );
  padding-inline: calc(
    var(--header-padding-inline-start, clamp(1rem, 4vw, 2rem)) +
      (1rem - var(--header-padding-inline-start, clamp(1rem, 4vw, 2rem))) *
      var(--header-scroll-progress, 0)
  );
  // Scroll-driven color ramp: 0 = transparent, 1 = fully opaque #fc0.
  background-color: rgb(255 204 0 / var(--header-scroll-progress, 0));
  border-bottom: 1px solid
    color-mix(in srgb, var(--color-border) 75%, transparent);
  // Scroll-driven blur ramp: 0 = none, 1 = saturate(160%) blur(10px).
  backdrop-filter: saturate(var(--header-backdrop-saturate, 100%))
    blur(var(--header-backdrop-blur, 0px));
  -webkit-backdrop-filter: saturate(var(--header-backdrop-saturate, 100%))
    blur(var(--header-backdrop-blur, 0px));
  // Scroll-driven shadow ramp: 0 = no shadow, 1 = full requested shadow values.
  box-shadow:
    inset 0 1px 0
      rgb(255 255 255 / var(--header-shadow-highlight-opacity, 0)),
    0 8px 24px
      color-mix(
        in srgb,
        var(--color-border) var(--header-shadow-depth-mix, 0%),
        transparent
      );
  // Smooth interpolation for scroll-driven background, blur, and shadow values.
  transition:
    padding 220ms ease,
    background-color 220ms ease,
    border-color 220ms ease,
    box-shadow 220ms ease,
    backdrop-filter 220ms ease,
    -webkit-backdrop-filter 220ms ease;


  > * {
    min-width: 0;
  }

  // ── Brand block ──
  &_content {
    @include flex-row-center-end;
    flex-wrap: nowrap;
    gap: 0.5rem;
    min-width: 0;
    overflow: hidden;
    flex-shrink: 0;
  }

  &_logo {
    display: block;
    width: auto;
    max-height: 4rem;
    flex-shrink: 0;
  }

  &_name {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  // ── Inline nav (direct child of header) ──
  &_nav {
    flex: 1;
    min-width: 0;
  }

  // ── Inline contact (direct child of header) ──
  &_contact {
    @include flex-row-center-center;
    margin-left: auto;
    min-width: 0;
    white-space: nowrap;
    // Shrinks with viewport; never below 0.5rem before collapsing into menu panel.
    gap: clamp(0.5rem, 1vw, 0.875rem);
    flex-shrink: 0;
  }

  // ── Menu button (hidden on full desktop) ──
  &_menuButton {
    @include flex-row-center-center;
    flex-shrink: 0;
    margin-left: auto;
    border: 1px solid color-mix(in srgb, $secondary-color 85%, transparent);
    background-color: transparent;
    color: $secondary-color;
    padding: 0.5rem;
    cursor: pointer;
    transition: border-color 180ms ease, color 180ms ease;

    &:hover,
    &:focus-visible {
      border-color: $secondary-color;
      color: $secondary-color;
      outline: none;
    }
  }

  // ── Dropdown panel (hidden by default at every width) ──
  &_menuPanel {
    display: none;
    @include flex-column-start-start;
    position: absolute;
    left: 0;
    right: 0;
    top: 100%;
    z-index: 20;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background-color: color-mix(
      in srgb,
      var(--color-bg-primary) 92%,
      transparent
    );
    border: 1px solid
      color-mix(in srgb, $border-color 80%, transparent);
    box-shadow: 0 8px 24px
      color-mix(in srgb, $border-color 28%, transparent);
    backdrop-filter: saturate(145%) blur(8px);
    -webkit-backdrop-filter: saturate(145%) blur(8px);
  }

  &_menuPanelOpen {
    display: flex;
  }

  &_menuPanelNav,
  &_menuPanelContact {
    width: 100%;
  }

  &_menuPanelNav {
    > *,
    > * > * {
      width: 100%;
    }
  }

  &_menuPanelContact {
    @include flex-column-start-start;
    align-items: stretch;
    gap: 0.5rem;

    > * {
      width: 100%;
    }

    > * > * {
      width: 100%;
    }
  }
}
